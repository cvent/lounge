<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Document Operations | Lounge</title>
    <meta name="description" content="Simple Mongoose-inspired ODM for Couchbase">
    
    
    <link rel="preload" href="/lounge/assets/css/0.styles.feb877a9.css" as="style"><link rel="preload" href="/lounge/assets/js/app.4f62df11.js" as="script"><link rel="preload" href="/lounge/assets/js/2.1ee5204e.js" as="script"><link rel="preload" href="/lounge/assets/js/10.2949d719.js" as="script"><link rel="prefetch" href="/lounge/assets/js/11.a1ea3960.js"><link rel="prefetch" href="/lounge/assets/js/12.bee45255.js"><link rel="prefetch" href="/lounge/assets/js/13.a93e3541.js"><link rel="prefetch" href="/lounge/assets/js/14.765dda7b.js"><link rel="prefetch" href="/lounge/assets/js/15.87f3dcbc.js"><link rel="prefetch" href="/lounge/assets/js/16.39a29adf.js"><link rel="prefetch" href="/lounge/assets/js/17.13ee8fcf.js"><link rel="prefetch" href="/lounge/assets/js/18.64cff16d.js"><link rel="prefetch" href="/lounge/assets/js/19.27de4646.js"><link rel="prefetch" href="/lounge/assets/js/20.5fd56dde.js"><link rel="prefetch" href="/lounge/assets/js/21.bd46a68a.js"><link rel="prefetch" href="/lounge/assets/js/22.f1e3b039.js"><link rel="prefetch" href="/lounge/assets/js/23.4c89548c.js"><link rel="prefetch" href="/lounge/assets/js/24.f4f63d9b.js"><link rel="prefetch" href="/lounge/assets/js/25.46f6bec9.js"><link rel="prefetch" href="/lounge/assets/js/26.74c79eab.js"><link rel="prefetch" href="/lounge/assets/js/27.17bc2875.js"><link rel="prefetch" href="/lounge/assets/js/3.d4eb21b0.js"><link rel="prefetch" href="/lounge/assets/js/4.2ca7c99c.js"><link rel="prefetch" href="/lounge/assets/js/5.cda0c2be.js"><link rel="prefetch" href="/lounge/assets/js/6.4f70d6da.js"><link rel="prefetch" href="/lounge/assets/js/7.2b15dbed.js"><link rel="prefetch" href="/lounge/assets/js/8.461f3ad7.js"><link rel="prefetch" href="/lounge/assets/js/9.caba79c2.js">
    <link rel="stylesheet" href="/lounge/assets/css/0.styles.feb877a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lounge/" class="home-link router-link-active"><!----> <span class="site-name">Lounge</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lounge/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/lounge/api/" class="nav-link">API Reference</a></div><div class="nav-item"><a href="https://github.com/bojand/lounge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lounge/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="/lounge/api/" class="nav-link">API Reference</a></div><div class="nav-item"><a href="https://github.com/bojand/lounge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lounge/guide/" class="sidebar-link">Introduction</a></li><li><a href="/lounge/guide/modeling.html" class="sidebar-link">Modeling</a></li><li><a href="/lounge/guide/types.html" class="sidebar-link">Types</a></li><li><a href="/lounge/guide/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/lounge/guide/extend.html" class="sidebar-link">Schema Extension</a></li><li><a href="/lounge/guide/embedded.html" class="sidebar-link">Embedded Documents</a></li><li><a href="/lounge/guide/docops.html" class="active sidebar-link">Document Operations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lounge/guide/docops.html#saving-documents" class="sidebar-link">Saving Documents</a></li><li class="sidebar-sub-header"><a href="/lounge/guide/docops.html#getting-documents" class="sidebar-link">Getting Documents</a></li><li class="sidebar-sub-header"><a href="/lounge/guide/docops.html#removing-documents" class="sidebar-link">Removing Documents</a></li></ul></li><li><a href="/lounge/guide/population.html" class="sidebar-link">Population</a></li><li><a href="/lounge/guide/simple_indexes.html" class="sidebar-link">Simple Indexes</a></li><li><a href="/lounge/guide/queries.html" class="sidebar-link">Index queries</a></li><li><a href="/lounge/guide/array_indexes.html" class="sidebar-link">Array Indexes</a></li><li><a href="/lounge/guide/embedded_indexes.html" class="sidebar-link">Embedded Indexes</a></li><li><a href="/lounge/guide/compound.html" class="sidebar-link">Compound Indexes</a></li><li><a href="/lounge/guide/lean_queries.html" class="sidebar-link">Lean Queries</a></li><li><a href="/lounge/guide/events.html" class="sidebar-link">Events</a></li><li><a href="/lounge/guide/promises.html" class="sidebar-link">Promises</a></li><li><a href="/lounge/guide/debugging.html" class="sidebar-link">Debug Logging</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="document-operations"><a href="#document-operations" aria-hidden="true" class="header-anchor">#</a> Document Operations</h1> <h2 id="saving-documents"><a href="#saving-documents" aria-hidden="true" class="header-anchor">#</a> Saving Documents</h2> <p>Saving documents is done using <code>save</code> function that every model instance has. This will execute all pre
'save' middleware and then perform Couchbase <code>upsert</code> operation on any subdocuments and the actual document. It will also
perform lookup document updates and finally execute any post hook middleware.</p> <p>From our example code above:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> savedDoc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>All documents and subdocuments would be upserted into the database.</p> <p><strong>Model.save(data, options, fn)</strong></p> <p><code>data</code> - any data to be set into the model before saving.</p> <p><strong>options</strong></p> <p>All options not present here are first looked up from schema options, and then from config options.</p> <ul><li><code>storeFullReferenceId</code> - whether to save embedded document property values as full document keys or just the base value</li> <li><code>storeFullKey</code> - whether to save the internal document key property as fully expanded value or as the simple value</li> <li><code>refIndexKeyPrefix</code> - lookup index document key prefix.</li> <li><code>waitForIndex</code> - whether we want to wait for indexing to finish before returning. default is false.</li> <li><code>virtuals</code> - whether we want to save virtuals. default is <code>false</code>.</li> <li><code>minimize</code> - to &quot;minimize&quot; the document by removing any empty properties. Default: <code>true</code></li> <li><code>expiry</code> - couchbase upsert option</li> <li><code>persist_to</code> - couchbase persist_to option</li> <li><code>replicate_to</code> - couchbase option</li></ul> <h2 id="getting-documents"><a href="#getting-documents" aria-hidden="true" class="header-anchor">#</a> Getting Documents</h2> <p>All models created come with a static function <code>findById</code> that can be used to look up a single or multiple keys and
retrieve documents from the database. If key does not exist and document is not found we <strong>do not</strong> return an error
but also no model is generated. This is different than present couchbase module behaviour.</p> <div class="language-js extra-class"><pre class="language-js"><code>User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">'user123'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// there was an error looking up the key</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>doc<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'no document found'</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token comment">// doc is instance of User and will print it out</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>We can get multiple keys using an array as the first parameter. In this case, the callback invoked is passed 3 arguments
in form <code>(err, documents, misses)</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user123'</span><span class="token punctuation">,</span> <span class="token string">'user456'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs<span class="token punctuation">,</span> misses</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// there was an error looking up the key</span>
  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>        <span class="token comment">// array of Users found</span>
  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>misses<span class="token punctuation">)</span>      <span class="token comment">// array if keys not found.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>When <code>findById</code> is invoked using a single string argument the result returned is a single model instance. When an array
is passed in we return the results as described above. To force <code>array</code> type of returns in <strong>all</strong> cases, set the Lounge
config option <code>alwaysReturnArrays</code> to <code>true</code>. Default is <code>false</code>.</p> <p>By default order of the generated objects in an array result is not guaranteed to be the same order as the ids queried.
To keep the order of the returned model instances the same as the ids set <code>keepSortOrder</code> option to <code>true</code>.</p> <p>By default the <code>findById</code> and index query functions return 3 parameters to the callback in form <code>(err, docs, missing)</code>.
If we want to force returning of 2 params at all times <code>(err, docs)</code>, and not return the <code>missing</code> parameter, we can
use the <code>missing</code> options either in <code>Lounge</code> settings to set globally, or individually in function invocations. If
<code>missing</code> option is set to <code>false</code> we won't return missing keys as the final param in the callback.</p> <div class="language-js extra-class"><pre class="language-js"><code>lounge<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token string">'missing'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user123'</span><span class="token punctuation">,</span> <span class="token string">'user456'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs<span class="token punctuation">,</span> misses</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// there was an error looking up the key</span>
  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>        <span class="token comment">// array of Users found</span>
  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>misses<span class="token punctuation">)</span>      <span class="token comment">// undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>lounge<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token string">'missing'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user123'</span><span class="token punctuation">,</span> <span class="token string">'user456'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> missing<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs<span class="token punctuation">,</span> misses</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// there was an error looking up the key</span>
  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>        <span class="token comment">// array of Users found</span>
  console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>misses<span class="token punctuation">)</span>      <span class="token comment">// array of missing keys, as the option in function params takes presidence</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="removing-documents"><a href="#removing-documents" aria-hidden="true" class="header-anchor">#</a> Removing Documents</h2> <p>Removing documents is done using <code>remove</code> function that every model instance has. This will execute all pre
'remove' middleware and then perform Couchbase <code>remove</code> operation. It will also perform lookup document updates
and finally execute any post hook middleware. By default this function <strong>does not</strong> remove embedded documents. To do
this set <code>removeRefs</code> options to <code>true</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>If we want all subdocuments to be removed:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> <span class="token punctuation">{</span>removeRefs<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>This will execute removal, hooks and indexing operations for all documents and subdocuments.</p> <p>Models have static <code>remove</code> function that can be used to perform document removal.</p> <div class="language-js extra-class"><pre class="language-js"><code>User<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'user123'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/lounge/guide/embedded.html" class="prev">
          Embedded Documents
        </a></span> <span class="next"><a href="/lounge/guide/population.html">
          Population
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lounge/assets/js/app.4f62df11.js" defer></script><script src="/lounge/assets/js/2.1ee5204e.js" defer></script><script src="/lounge/assets/js/10.2949d719.js" defer></script>
  </body>
</html>
